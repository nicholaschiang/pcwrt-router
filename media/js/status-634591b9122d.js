function showHosts(){$("#assocs tr:gt(0)").remove(),$.each(fv.assocs,function(t,a){a.complete&&$("#assocs").append(String.format('<tr><td><a class="%s" href="#">%s</a></td><td>%s</td><td>%s</td><td>%s</td><td>%s</td></tr>',a.ip_assign,a.hostname,a.ipaddr,a.mac,a.net,a.signal))})}function refreshHosts(){pcwrt.submit_form($("#refresh-hosts-form"),[],function(t){"success"==t.status&&(fv.netaddrs=t.data.netaddrs,fv.assocs=t.data.assocs,fv.assocs.sort(function(t,a){return(""+t.hostname).toUpperCase()>(""+a.hostname).toUpperCase()?1:-1}),showHosts(),updateIncompleteIps())},null,!1,window.msgs.refresh_hosts)}function updateIncompleteIps(){var r=0;$.each(fv.netaddrs,function(t,e){var s=[];if($.each(fv.assocs,function(t,a){is_ip_on_network(a.ipaddr,e.ip,e.mask)&&!a.complete&&s.push(a.ipaddr)}),0<s.length){0==r&&$("#refresh-hosts").unbind("click").startRotate(),r++;var a=[];a.push({name:"iface",value:e.name}),a.push({name:"ips",value:s}),pcwrt.submit_form($("#get-ip-status-form"),a,function(e){$.each(fv.assocs,function(t,a){e.data.ips[a.ipaddr]&&(a.complete=!0)}),0==--r&&($("#refresh-hosts").stopRotate().on("click",function(t){t.preventDefault(),refreshHosts()}),showHosts())},"application/x-www-form-urlencoded",!0)}}),0==r&&$("#refresh-hosts").on("click",function(t){t.preventDefault(),refreshHosts()})}String.prototype.format=function(){if(RegExp){var t=[/&/g,"&#38;",/"/g,"&#34;",/'/g,"&#39;",/</g,"&#60;",/>/g,"&#62;"],a=[/"/g,"&#34;",/'/g,"&#39;"],e=this,s="",r=/^(([^%]*)%('.|0|\x20)?(-)?(\d+)?(\.\d+)?(%|b|c|d|u|f|o|s|x|X|q|h|j|t|m))/,n=b=[],o=0,i=0;while(n=r.exec(e)){var f=n[1],c=n[2],d=n[3],p=n[4],l=n[5],h=n[6],m=n[7];if(i++,"%"==m)x="%";else if(o<arguments.length){var v=arguments[o++],u="";d&&"'"==d.substr(0,1)?u=c.substr(1,1):d&&(u=d);var $=!0;p&&"-"===p&&($=!1);var g=-1;l&&(g=parseInt(l));var w=-1;h&&"f"==m&&(w=parseInt(h.substring(1)));var x=v;switch(m){case"b":x=(parseInt(v)||0).toString(2);break;case"c":x=String.fromCharCode(parseInt(v)||0);break;case"d":x=parseInt(v)||0;break;case"u":x=Math.abs(parseInt(v)||0);break;case"f":x=-1<w?(parseFloat(v)||0).toFixed(w):parseFloat(v)||0;break;case"o":x=(parseInt(v)||0).toString(8);break;case"s":x=v;break;case"x":x=(""+(parseInt(v)||0).toString(16)).toLowerCase();break;case"X":x=(""+(parseInt(v)||0).toString(16)).toUpperCase();break;case"h":x=M(v,t);break;case"q":x=M(v,a);break;case"j":x=String.serialize(v);break;case"t":var q=0,k=0,_=0,I=v||0;60<I&&(_=Math.floor(I/60),I%=60),60<_&&(k=Math.floor(_/60),_%=60),24<k&&(q=Math.floor(k/24),k%=24),x=0<q?String.format("%dd %dh %dm %ds",q,k,_,I):String.format("%dh %dm %ds",k,_,I);break;case"m":var S=l?parseInt(l):1e3,C=h?Math.floor(10*parseFloat("0"+h)):2,y=0,H=parseFloat(v||0),F=["","K","M","G","T","P","E"];for(y=0;y<F.length&&S<H;y++)H/=S;x=H.toFixed(C)+" "+F[y]}}s+=c+x,e=e.substr(f.length)}return s+e}function M(t,a){for(var e=0;e<a.length;e+=2)t=t.replace(a[e],a[e+1]);return t}},String.format=function(){for(var t=[],a=1;a<arguments.length;a++)t.push(arguments[a]);return"".format.apply(arguments[0],t)},$(function(){$("#hostname").on("keypress",function(){$(this).parent().removeClass("has-error"),$(this).siblings(".form-control-error").remove()}),$("#assocs").on("click","a",function(t){t.preventDefault(),$("#ip").val($(this).parent().next().text()),$("#mac").val($(this).parent().next().next().text()),$("#hostname").val($(this).text()).siblings(".form-control-error").remove().end().parent().removeClass("has-error"),$("#hostname-modal").data("mac",$(this).parent().next().next().text()).modal("show")}),$("#hostname-modal button[type=submit]").on("click",function(t){t.preventDefault();var a=$(this).parents("form");pcwrt.submit_form(a,a.serialize(),function(t){var e=$("#hostname-modal").data("mac");$("#assocs tr:gt(0) a").each(function(){$(this).parent().next().next().text()==e&&$(this).text($("#hostname").val()).removeClass("dynamic").addClass("static")}),$.each(fv.assocs,function(t,a){a.mac==e&&(a.ip_assign="static",a.hostname=$("#hostname").val())}),$("#hostname-modal").modal("hide"),pcwrt.apply_changes(t.apply)})}),$("#localtime").text(fv.localtime),$("#uptime").text(String.format("%t",fv.uptime)),$("#loadavg").text(String.format("%.02f, %.02f, %.02f",fv.loadavg[0],fv.loadavg[1],fv.loadavg[2]));var t=$("#wan-stat tr:first");fv.wan_stat.up?(t.hide(),$("#wan-stat tr:eq(1) td:eq(1)").text(fv.wan_stat.proto),$("#wan-stat tr:eq(2) td:eq(1)").text(fv.wan_stat.ipaddr),$("#wan-stat tr:eq(3) td:eq(1)").text(fv.wan_stat.netmask),$("#wan-stat tr:eq(4) td:eq(1)").text(fv.wan_stat.gwaddr),1<fv.wan_stat.dns.length?$("#wan-stat tr:eq(5) td:eq(1)").text(fv.wan_stat.dns[0]+", "+fv.wan_stat.dns[1]):$("#wan-stat tr:eq(5) td:eq(1)").text(fv.wan_stat.dns[0]),$("#wan-stat tr:eq(6) td:eq(1)").text(String.format("%t",fv.wan_stat.uptime)),fv.wan_stat.macaddr?$("#wan-stat tr:eq(7) td:eq(1)").text(fv.wan_stat.macaddr):$("#wan-stat tr:eq(7)").hide()):($("td:eq(1)",t).text("down"),t.siblings().hide());for(var a=1;a<fv.wifinets.length;a++){var e=$("#wifi-stat .nav-tabs>li:first").clone();e.removeClass("active"),$("#wifi-stat .nav-tabs").append(e);var s=$("#wifi-stat .tab-content>div:first").clone();s.removeClass("in active"),$("#wifi-stat .tab-content").append(s)}1<fv.wifinets.length?$("#wifi-stat .nav-tabs").show():$("#wifi-stat .tab-content,#wifi-stat .tab-pane").css("padding-top",0),$.each(fv.wifinets,function(t,a){var e=$("#wifi-stat").find(".nav-tabs>li:eq("+t+") a").attr("href","#"+a.band.replace(/[^0-9a-zA-Z]/g,"-")+t).attr("aria-controls",a.band).text(a.band).end().find(".tab-pane:eq("+t+")").attr("id",a.band.replace(/[^0-9a-zA-Z]/g,"-")+t);a.up?($("table tr:first td:eq(1)",e).text(a.ssid),$("table tr:eq(1) td:eq(1)",e).text(a.mode),$("table tr:eq(2) td:eq(1)",e).text(String.format("%s (%.03f GHz)",a.channel,a.frequency)),$("table tr:eq(3) td:eq(1)",e).text(a.encryption)):$("table tr:first td:eq(1)",e).text(String.format("%s (disabled)",a.ssid)).parent().siblings().hide()}),fv.assocs.sort(function(t,a){return(""+t.hostname).toUpperCase()>(""+a.hostname).toUpperCase()?1:-1}),showHosts(),updateIncompleteIps()});