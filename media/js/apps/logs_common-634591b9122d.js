function format_date(t,e,a){var n=new Date(1e3*t),s=n.getDate(),r=n.getMonth()+1,i=n.getFullYear();return a?r+"/"+s+" "+get_hm(t,e,!0):r+"/"+s+"/"+i+" "+get_hm(t,e,!0)}function get_last_date(t){var e=new Date(t);return 30<e.getMinutes()?(e.setMinutes(0),e.setHours(e.getHours()+1)):(0<e.getMinutes()||0<e.getSeconds())&&e.setMinutes(30),e.setSeconds(0),e.setMilliseconds(0),e}function get_timeslots(t){var e=get_last_date(plotter_state.plot_now),a=e.getTime()/1e3;e.setHours(e.getHours()-t),e.setSeconds(0);var n=[],s=e.getTime()/1e3;while(s<a)end=s+900,n.push({start:s,end:end}),s=end;return n}function process_raw_data(a,t){var n,s,r=a.shift(),i=new_slot_data(r);$.each(t.split(/\r?\n/),function(t,e){if(""==e)return!1;var t=e.indexOf(" ");if(n=parseInt(e.substr(0,t)),s=e.substr(t+1),n>=i.start){while(n>=i.end){if(plotter_state.data[i.start.toString()]=i,!(r=a.shift()))return!1;i=new_slot_data(r)}add_slot_entry(i,n,s)}}),n<=i.end&&(plotter_state.data[i.start.toString()]=i,r=a.shift());while(r)i=new_slot_data(r),plotter_state.data[i.start.toString()]=i,r=a.shift()}function fetch_data(e,a){0!=e.length?fetch_raw_data(get_fetch_range(e),function(t){process_raw_data(e,t),a()}):a()}function get_fetch_slots(t){var n=[];return $.each(t,function(t,e){var a=e.start.toString();(!plotter_state.data[a]||plotter_state.data[a].partial&&need_new_data())&&n.push(e)}),plotter_state.last_fetch=(new Date).getTime(),n}function need_new_data(){return 6e4<=(new Date).getTime()-plotter_state.last_fetch}function get_fetch_range(t){var a=[],n=0,s=0;return $.each(t,function(t,e){s=(0==n?n=e.start:e.start==s||(a.push(n+"-"+s),n=e.start),e.end)}),0<n&&a.push(n+"-"+s),a.join(",")}function fetch_raw_data(t,e){var a=$("#fetch-data");$("[name=r]",a).val(t),pcwrt.submit_form(a,a.serialize(),{success:function(t){$("#start").hide(),$("#logs").show(),e(t.data)},fail:function(t){$("#start").hide(),$("#error").show()}},null,!1,"Retrieving data")}function get_hm(t,e,a){var n=new Date(1e3*t),s=n.getHours(),r=n.getMinutes()<10?"0"+n.getMinutes():n.getMinutes(),i=n.getSeconds()<10?"0"+n.getSeconds():n.getSeconds(),o;return o=a?s<12?"am":"pm":s<12?"<small>am</small>":"<small>pm</small>",12<s&&(s-=12),0==s&&(s=12),e?s+":"+r+":"+i+" "+o:s+":"+r+o}function get_range(t){var e=t?"2H":$("#range li.active").text();return/^\d+H$/.test(e)?parseInt(e):0}function hookup_left_right_events(e){var t=get_last_date(window.plotter_state.now),a=new Date(t.getTime());a.setHours(a.getHours()-24),1e3*e[0].start<=a.getTime()?$(".canvas .left").css("visibility","hidden"):$(".canvas .left").css("visibility","visible"),1e3*e[e.length-1].end>=t.getTime()?(plotter_state.max_time=1e3*e[e.length-1].end,$(".canvas .right").css("visibility","hidden")):$(".canvas .right").css("visibility","visible"),$(".canvas .left").off("click").on("click",function(t){t.preventDefault(),prepare_reset(),window.plotter_state.plot_now=1e3*e[0].start,redraw()}),$(".canvas .right").off("click").on("click",function(t){t.preventDefault(),prepare_reset(),window.plotter_state.plot_now=1e3*(e[e.length-1].end+3600*get_range(get_raw_switch())),window.plotter_state.plot_now>window.plotter_state.now&&(plotter_state.plot_now=plotter_state.now),redraw()})}function get_raw_switch(){return 0<$("#format-switch").length&&!$("#format-switch").prop("checked")}window.plotter_state={data:{},last_fetch:0,max_time:0},Array.prototype.extend||(Array.prototype.extend=function(t){t.forEach(function(t){this.push(t)},this)});