var doh_hosts={"opendns-a":["208.67.222.123","208.67.220.123"],"opendns-b":["208.67.222.222","208.67.220.220"],"cleanbrowsing-a":["185.228.168.9","185.228.169.9"],"cleanbrowsing-b":["185.228.168.10","185.228.169.11"],"cleanbrowsing-c":["185.228.168.168","185.228.169.168"],"cloudflare-1":["1.1.1.1","1.0.0.1"],"cloudflare-2":["1.1.1.2","1.0.0.2"],"cloudflare-3":["1.1.1.3","1.0.0.3"],"adguard-1":["94.140.14.14","94.140.15.15"],"adguard-2":["94.140.14.15","94.140.15.16"],"adguard-3":["94.140.14.140","94.140.14.141"],google:["8.8.8.8","8.8.4.4"],quad9:["9.9.9.9","149.112.112.112"]};function findDOHProvider(a){var r=null;return $.each(doh_hosts,function(e,n){if(n.length==a.length){for(var o=!0,t=0;t<n.length;t++)if(n[t]!=a[t]){o=!1;break}if(o)return r=e,!1}}),r}function switch_protocol(){var e=$("#protosel").val();$(".proto-option").each(function(){this.id=="proto-"+e?$(this).removeClass("hidden").find('input[name="proto"]').val(e):$(this).addClass("hidden")})}function switch_peerdns(e){$(e).prop("checked")?$(e).parent().next().slideDown().next().slideDown():$(e).parent().next().slideUp().next().slideUp()}function switch_doh(e){var n=$(e).parent().next();if($(e).prop("checked")){n.slideDown();var o=findDOHProvider([n.parent().next().find("[name=dns1]").val().trim(),n.parent().next().find("[name=dns2]").val().trim()]);o?($('[name="doh-select"]').val(o),n.parent().next().find("[name=dns1]").prop("readonly",!0).end().find("[name=dns2]").prop("readonly",!0)):n.find('[name="doh-select"]').trigger("selection.change",[0,null])}else n.slideUp(),n.find('[name="doh-select"]').trigger("selection.change",[0,""])}function switch_randommac(e){e.prop("checked")?e.parent().next().slideDown():e.parent().next().slideUp()}function send_update(e){pcwrt.submit_form(e,e.serialize(),function(e){pcwrt.showOverlay($("#spinner")),$("<iframe/>",{src:e.reload_url+"?addr="+e.addr+"&page=settings%2Finternet"}).appendTo("#reloader")})}$("body").on("selection.change",".combo-facade[name=doh-select]",function(e,n,o,t){var a=$(this).parent().parent().parent(),r=a.find("[name=doh]"),i=a.next().find("[name=dns1]"),d=a.next().find("[name=dns2]");null===o&&(o=$(this).val());var s=doh_hosts[o];r.is(":visible")&&r.prop("checked")&&s?(i.val(s[0]).prop("readonly",!0),d.val(s[1]).prop("readonly",!0)):(i.prop("readonly",!1),d.prop("readonly",!1))}),$(function(){if($("label.required").add_required_mark(window.msgs.required),$("label.control-label[data-hint]").init_hint(),$("input[data-units]").makeunit(),$("select").makecombo(),$("#dhcp-macrefresh").on("unit.change",function(e,n){$(this).parent().parent().removeClass("has-error").find(".form-control-error").remove(),"o"==n?$(this).prop("value","").prop("disabled",!0):$(this).prop("disabled",!1)}),pcwrt.populate_forms(),switch_protocol(),$("[name=peerdns]").each(function(){switch_peerdns(this)}),$("[name=doh]").each(function(){switch_doh(this)}),switch_randommac($("#dhcp-randommac")),"1"==fv.doh){var e=findDOHProvider([fv.dns1,fv.dns2]);e?$('[name="doh-select"]').val(e):$('[name="doh-select"]').trigger("selection.change",[0,$('[name="doh-select"]').val()])}$("#protosel").on("change",function(){switch_protocol()}),$("[name=peerdns]").each(function(){$(this).on("click",function(){switch_peerdns(this)})}),$("[name=doh]").each(function(){$(this).on("click",function(){switch_doh(this)})}),$("#dhcp-randommac").on("click",function(){switch_randommac($(this))}),$('button[type="submit"]').on("click",function(e){e.preventDefault();var n=$(this).parents("form");if("dhcp"==$("#protosel").val()){var o=$("#dhcp-macrefresh").val().match(/^(\d+)h$/);o&&2==o.length&&o[1]<24?pcwrt.confirm_action(msgs.random_mac_warn_title,msgs.random_mac_warn_msg,function(){send_update(n)}):send_update(n)}else send_update(n)})});